# Brreg Search PCF Control
A Power Apps Component Framework (PCF) control that integrates with the Norwegian BrÃ¸nnÃ¸ysund Register Centre (BrÃ¸nnÃ¸ysundregistrene) API, enabling users to search for companies and automatically populate form columns with official company data.

## Features
ðŸ” **Dual Search Modes**
- **Basic Search:** Search companies by name
- **Advanced Search:** Search by Organization ID and Industry Code

ðŸ“‹ **Automatic Data Population**
- Company address and street information
- City and postal code
- Contact details (phone, email, website)
- Registration date
- Coordinates (latitude/longitude)

ðŸ› ï¸ **Tools**
- **Export to Excel:** Download company data in spreadsheet format
- **View JSON:** Inspect complete API response with copy functionality
- **Map Integration:** View company location on OpenStreetMap with the option to pin alternative address

ðŸŽ¨ **Display Options** 
- **Button / Dialog Mode:** Opens a dialog for company search and selection
- **Form Mode:** Embedded search interface directly in the form

## Multi-Language Support
- ðŸ‡³ðŸ‡´ Norwegian (BokmÃ¥l)
- ðŸ‡ºðŸ‡¸ English (United States)
- ðŸ‡©ðŸ‡ª German (Germany)
- ðŸ‡ªðŸ‡¸ Spanish (Spain)
- ðŸ‡®ðŸ‡¹ Italian (Italy)
- ðŸ‡¸ðŸ‡ª Swedish (Sweden)
- ðŸ‡©ðŸ‡° Danish (Denmark)
- ðŸ‡«ðŸ‡® Finnish (Finland)
- ðŸ‡µðŸ‡± Polish (Poland)
- ðŸ‡³ðŸ‡± Dutch (Netherlands)
  
> ðŸ¤– **Proudly translated by Claude AI** - No Google Translate was harmed in the making of these translations!  
> *(Fun fact: This witty remark was also generated by Claude AI. Multi-talented much? ðŸ’â€â™€ï¸)*

## Configuration
The control can be configured through the Power Apps interface when adding it to a form column. Below are the available configuration options.

### Configuration Parameters
| Parameter | Type | Description | Default | Options |
|:---|:---|:---|:---|:---|
| `mode` | Enum | Display mode | `"button"` | `"button"`, `"form"` |
| `theme` | Enum | UI Theme | `"webLight"` | `"webLight"`, `"webDark"`, `"teamsLight"`, `"teamsDark"`, `"teamsHighContrast"` |
| `pageSize` | Number | Number of companies to return when searching | `10` | Any `positive integer` and can not be `higher than 100` |
| `showTitle` | Boolean | Show the title of the form or dialog | `false` | `true`/`false` |
| `showViewJsonButton` | Boolean | Show JSON viewer button | `false` | `true`/`false` |
| `showViewMapButton` | Boolean | Show map viewer button | `false` | `true`/`false` |
| `showExportExcelButton` | Boolean | Show Excel export button | `false` | `true`/`false` |
| `enableAdvancedSearch` | Boolean | Enable advanced search options | `false` | `true`/`false` |

> [!NOTE]  
> The geocoding service for latitude and longitude coordinates only works when `showViewMapButton` is enabled in the configuration.

### Column Binding Properties
The following properties can be bound to form columns to automatically populate company data:
| Property | Display Name | Type | Description | Required |
|:---|:---|:---|:---|:---|
| `organisasjonsnummer` | Organization Number | Text | Company organization number | `false` |
| `navn` | Company Name | Text | Official company name | `false` |
| `adress` | Address | Text | Company street address | `false` |
| `postnummer` | Postal Code | Text | Postal code | `false` |
| `poststed` | City | Text | City name | `false` |
| `registrationDate` | Registration Date | Date | Company registration date | `false` |
| `email` | Email | Email | Company email address | `false` |
| `phone` | Phone | Phone | Company phone number | `false` |
| `website` | Website | URL | Company website | `false` |
| `lat` | Latitude | Number | Location latitude coordinate | `false` |
| `lng` | Longitude | Number | Location longitude coordinate | `false` |

In the example below, we are configuring the control in **Button / Dialog mode** on a **Quick Create form**.
We're using the Account Name column (though it can be any **Single Line of Text** column). The label is hidden, and the Search Brreg control is added to that column.
In the configuration panel, we enable the **showViewMapButton** option and map the columns from the API to the desired columns in the Account table.

> [!NOTE]  
> This control can be used on any table, we're just using `Account` for demo purposes.

![setup](https://github.com/user-attachments/assets/1c9cb695-b504-44f3-a6b8-79ffdc21c058)

## <ins> Button / Dialog Mode </ins>
The control appears as a **search button** that opens a **dialog** when clicked. Perfect for quick company searches during record creation.

### Use Cases:
- Quick create forms
- Lead qualification quick create forms

![button-mode](https://github.com/user-attachments/assets/03df935e-17ec-4772-a5bf-243b89d1f6f7)

## <ins> Form Mode </ins>
The control is **embedded directly** into the form as an integrated search interface. No dialog needed, search and select right on the form.

### Use Cases:
- Main forms
- Lead qualification forms

![form-mode](https://github.com/user-attachments/assets/d1c2a6ec-2960-4bec-9e7f-915014a40dea)

## Themes

The component uses **Fluent UI React v9 themes**: `webLight` (default), `webDark`, `teamsLight`, `teamsDark`, and `teamsHighContrast`.

![themes](https://github.com/user-attachments/assets/ca1b05b4-0539-42ec-b1b1-4cd93979d793)

## Installation
Choose one of the following deployment options:

### Option 1: Managed Solution
1. Download the ðŸ“¦ [managed solution](https://github.com/shamak1/brreg-search/raw/refs/heads/main/Solutions/bin/release/Solutions.zip)
2. Import the solution into your Power Platform environment

### Option 2: Unmanaged Solution
1. Download the ðŸ“¦ [unmanaged solution](https://github.com/shamak1/brreg-search/raw/refs/heads/main/Solutions/bin/Debug/Solutions.zip)
2. Import the solution into your Power Platform environment

### Option 3: Deploy from Source Code
Deploy the component directly from the ðŸ’» source code by following these steps:

#### Prerequisites
- [Node.js](https://nodejs.org/)
- [Microsoft Power Platform CLI](https://docs.microsoft.com/en-us/powerapps/developer/data-platform/powerapps-cli)

#### Deployment Steps
1. Clone the repository:
   ```bash
   git clone https://github.com/shamak1/brreg-search.git
   cd brreg-search
   ```

2. Install dependencies:
   ```bash
   npm install
   ```

3. Authenticate with your Power Platform environment:
   ```bash
   pac auth create --environment "https://your-environment.crm.dynamics.com/"
   ```
   > Replace `https://your-environment.crm.dynamics.com/` with your actual Power Platform environment URL

4. Push the component to your environment:
   ```bash
   pac pcf push --publisher-prefix "YOUR_PREFIX"
   ```
   > Replace `YOUR_PREFIX` with your organization's publisher prefix (e.g., if your publisher prefix is "contoso", use `--publisher-prefix contoso`)
  
For detailed guidance on deploying Power Apps Component Framework components, refer to the [official Microsoft documentation](https://learn.microsoft.com/en-us/power-apps/developer/component-framework/import-custom-controls#deploying-code-components).
> ðŸ¤– Psst, friendly AI reminder: There are probably other creative ways to install this solution too, I just covered the popular ones. Go find your own adventure!

## API Details
This component uses:
- **BrÃ¸nnÃ¸ysundregistrene API**: Official Norwegian business registry
- **OpenStreetMap Nominatim**: Free geocoding service

> [!IMPORTANT]  
> This component uses OpenStreetMap's free Nominatim geocoding service, which has a **1 request per second per IP address** rate limit.

## Acknowledgments
- [Brreg API](https://www.brreg.no/bruke-data-fra-bronnoysundregistrene/apne-data/)
- [OpenStreetMap](https://www.openstreetmap.org/)
- [Leaflet](https://leafletjs.com/)

